{% extends 'base.html' %}
{% block content %}
<h1>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è ‚Äî {{ month_name }} {{ year }}</h1>

<!-- ====== –°–µ—Ç–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è ====== -->
<div class="calendar">
  {% for day in days %}
  {% if day.date %}
    <button class="day-btn"
            data-date="{{ day.full }}"
            style="background-color: {{ day.color }}">
      {{ day.date }}<br>
      <span class="emoji">{{ day.emoji }}</span>
    </button>
  {% else %}
    <div class="day empty"></div>
  {% endif %}
  {% endfor %}
</div>

<!-- ====== –ù–∞–≤–∏–≥–∞—Ü–∏—è ====== -->
<div class="nav">
  <a href="{{ url_for('show_calendar', year=prev_year, month=prev_month) }}">‚Üê –ü—Ä–µ–¥</a>
  <a href="{{ url_for('show_calendar', year=next_year, month=next_month) }}">–°–ª–µ–¥ ‚Üí</a>
</div>

<a href="{{ url_for('index') }}" class="back">‚Üê –ù–∞–∑–∞–¥</a>

<!-- ====== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ ====== -->
<div id="moodModal" class="modal">
  <div class="modal-content">
    <h3>–í—ã–±–µ—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</h3>
    <form method="POST" id="moodForm" action="{{ url_for('show_calendar', year=year, month=month) }}">
      <input type="hidden" name="date" id="selectedDate">
      <div class="mood-grid">
        {% for key, mood in moods.items() %}
        <label class="mood-option">
          <input type="radio" name="mood" value="{{ key }}" required>
          <span class="emoji-bg {{ key }}">{{ mood.emoji }}</span>
          <span>{{ mood.title }}</span>
        </label>
        {% endfor %}
      </div>
      <textarea name="note" placeholder="–î–æ–±–∞–≤—å –∑–∞–º–µ—Ç–∫—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
      <div class="buttons">
        <button type="submit" class="save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" id="cancelBtn" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </form>
  </div>
</div>

<!-- ====== JS ====== -->
<script>
const modal = document.getElementById('moodModal');
const dateInput = document.getElementById('selectedDate');
const cancelBtn = document.getElementById('cancelBtn');
const dayButtons = document.querySelectorAll('.day-btn');

// –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –ø–æ –∫–ª–∏–∫—É –Ω–∞ –¥–µ–Ω—å
dayButtons.forEach(btn => {
  btn.addEventListener('click', e => {
    e.preventDefault();
    const dateValue = btn.getAttribute('data-date');
    dateInput.value = dateValue;
    modal.style.display = 'flex';
  });
});

// –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–∫–Ω–∞ –∏–ª–∏ –ø–æ –∫–Ω–æ–ø–∫–µ –æ—Ç–º–µ–Ω—ã
cancelBtn.addEventListener('click', () => modal.style.display = 'none');
modal.addEventListener('click', e => {
  if (e.target === modal) modal.style.display = 'none';
});
</script>

<!-- ====== –°—Ç–∏–ª–∏ ====== -->
<style>
.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  justify-items: center;
  padding: 20px;
}
.day-btn, .day.empty {
  width: 70px;
  height: 70px;
  border-radius: 10px;
  border: none;
  box-shadow: 0 0 4px rgba(0,0,0,0.2);
  font-size: 18px;
  cursor: pointer;
  transition: 0.2s;
  background-color: #f6d28f;
}
.day-btn:hover {
  transform: scale(1.05);
  filter: brightness(1.1);
}
/* –º–æ–¥–∞–ª–∫–∞ */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  background: rgba(0,0,0,0.5);
  z-index: 10;
}
.modal-content {
  background: #f6d28f;
  padding: 20px;
  border-radius: 14px;
  width: 320px;
  text-align: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}
.mood-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin: 15px 0;
}
.mood-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
}
.mood-option input {
  display: none;
}
.emoji-bg {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  font-size: 26px;
  margin-bottom: 4px;
}
/* –¶–≤–µ—Ç–∞ –∫—Ä—É–∂–∫–æ–≤ */
.happy { background-color: #FFD700; }
.calm { background-color: #32CD32; color: #fff; }
.sad { background-color: #1E90FF; color: #fff; }
.anxious { background-color: #8A2BE2; color: #fff; }
.hard { background-color: #FF4C4C; color: #fff; }
.save-btn, .cancel-btn {
  background: linear-gradient(180deg, #f8e0b0, #d2a75e);
  color: #3b2605;
  border: 2px solid #5c3d1b;
  border-radius: 10px;
  padding: 8px 16px;
  font-weight: bold;
  margin: 5px;
  cursor: pointer;
  transition: 0.2s;
}
.save-btn:hover, .cancel-btn:hover {
  transform: translateY(-2px);
  filter: brightness(1.1);
}
/* --- –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –≤—ã–±–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è --- */
.mood-option input:checked + .emoji-bg {
  transform: scale(1.15);
  box-shadow: 0 0 12px rgba(0,0,0,0.3);
  border: 3px solid #fff8cc;
}
.mood-option input:checked + .emoji-bg + span {
  font-weight: bold;
  color: #2c1b01;
}
/* –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ */
.emoji-bg {
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  cursor: pointer;
}
</style>
{% endblock %}
