{% extends 'base.html' %}
{% block content %}
<h1>üìà –î–∏–Ω–∞–º–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞ –Ω–µ–¥–µ–ª—é</h1>

{% if dates %}
    <canvas id="trendChart" width="600" height="300"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    const ctx = document.getElementById('trendChart').getContext('2d');

    const dates = {{ dates | default([]) | tojson }};
    const scores = {{ scores | default([]) | tojson }};
    const colors = {{ colors | default([]) | tojson }};

    const moodLabels = {
        1: "–¢—è–∂–µ–ª–æ",
        2: "–ì—Ä—É—Å—Ç–Ω–æ",
        3: "–¢—Ä–µ–≤–æ–∂–Ω–æ",
        4: "–°–ø–æ–∫–æ–π–Ω–æ",
        5: "–†–∞–¥–æ—Å—Ç–Ω–æ"
    };

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                data: scores,
                borderColor: '#d18a33',
                backgroundColor: 'rgba(241, 186, 88, 0.25)',
                fill: true,
                pointRadius: 8,
                pointHoverRadius: 10,
                pointBackgroundColor: colors,
                tension: 0.35
            }]
        },
        options: {
            scales: {
                y: {
                    min: 0.5,
                    max: 5.5,
                    ticks: {
                        stepSize: 1,
                        callback: val => moodLabels[val] || ''
                    }
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(ctx) {
                            return moodLabels[ctx.parsed.y] || '';
                        }
                    }
                }
            }
        }
    });
    </script>
{% else %}
    <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π üòå</p>
{% endif %}

<div class="back-btn-container">
    <a href="{{ url_for('index') }}" class="back">‚Üê –ù–∞–∑–∞–¥</a>
</div>
{% endblock %}
